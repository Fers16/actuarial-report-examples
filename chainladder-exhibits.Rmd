---
title: "Creating Reports with ChainLadder Package Reserve Projections"
author: "Andy Merlino"
date: "Thusday, October 23, 2014"
output: pdf_document
---

\begin{abstract}
The `ChainLadder` package can create some powerful loss reserving projections.  The output from these reserving functions is a list containing all the relevant data an actuary would ever want.  The `exhibit` package extracts the most commonly desired `ChainLadder` function outputs and returns a data frame ready for a report.  This document displays how `exhibit` can be used along with other R packages to quickly create reports.  For more information on the `exhibit` package download the package and enter `browseVignettes("exhibit")` to see the introductory vignette.
\end{abstract}

# Required Packages and Data

```{r packages_and_options, message = FALSE, warning = FALSE}
# CRAN packages
library(ChainLadder) # reserving projections
library(pander) # make pretty tables

# Ractuary packages. Install with devtools::install_github("merlinoa/*")
library(exhibit) # default exhibits from ChainLadder package
library(casdata) # load in the data

# set pander table options
panderOptions('table.split.table', 125)
panderOptions('table.alignment.default', 'right')
```

This document echos all of the code because it is intended as a reference document.  In an actual actuarial report only the final table would be displayed.

The following examples use workers' compensation paid loss and ALAE from State Farm Mutual Group.  This data is provided by the [Casualty Actuarial Society](http://www.casact.org/research/index.cfm?fa=loss_reserves_data) and is made available in R through the `casdata` package.

```{r data}
# filter the data to be used in our projections
calendar <- wkcomp$AccidentYear + wkcomp$DevelopmentLag
state <- wkcomp[wkcomp$GRCODE == 1767 & calendar < 1999, ]
```

`state` consists of State Farm Mutual Group workers' compensation paid losses, incurred losses, and other information from accident years 1988 through 1997.

\pagebreak

Each code chuck operates as follows:

1. Use a `ChainLadder` function to make a reserve projection.
2. Use `exhibit()` to extract a data frame summary of that projection.
3. Use `eformat()` to apply a default format to the data frame returned by `exhibit()`.
4. Use `pander()` to make the table look good.

## Paid Loss & ALAE Triangle

```{r paid_loss_tri, results = 'asis'}
# create paid loss triangle
paid_tri <- as.triangle(state, origin = "AccidentYear",
                        dev = "DevelopmentLag", value = "CumPaidLoss_D")

# extracts a summary, format it, make it into a table
pander(exhibit(paid_tri, eformat = TRUE))

# Because you may want to have the unformatted output of exhibit
# for later use in an actuarial report, the above command can 
# also be executed like so.
# exhibit_paid_tri <- exhibit(paid_tri)
# pander(eformat(paid_tri))
```

\pagebreak

## Paid Development Triangle

```{r paid_dev_tri, results = 'asis'}
# create paid development triangle
paid_ata <- ata(paid_tri)

paid_ata <- exhibit(paid_ata)
# format paid development triangle for presentation
pander(eformat(paid_ata))
```

\pagebreak

# GLM Reserving model

Running the GLM model with default options is as easy as this:

```{r glm, results = "asis"}
glm_reserve <- exhibit(glmReserve(paid_tri))

pander(eformat(glm_reserve))
```

\pagebreak

If we select to use the bootstrap method to estimate the mean squared error, the `glmReserve` function provides confidence levels.

```{r glm_boot, results = 'asis'}
glm_boot <- glmReserve(paid_tri, mse.method = "boot")
glm_boot_exhibit <- exhibit(glm_boot)

pander(eformat(glm_boot_exhibit))
```

\pagebreak

```{r glm_cl_table, results = 'asis'}
pr <- as.data.frame(glm_boot$sims.reserve.pred)
qv <- c(0.5, 0.75, 0.9, 0.95, 0.975, 0.99)
res_q <- t(apply(pr, 2, quantile, qv))
pander(eformat(as.data.frame(res_q)))
```

\pagebreak

Mack Chain Ladder

```{r mack, results = 'asis'}
mack <- MackChainLadder(paid_tri)
mack <- exhibit(mack)

pander(eformat(mack))
```

Bootstrap Chain Ladder

```{r boot, results = 'asis'}
boot <- BootChainLadder(paid_tri)

boot <- exhibit(boot)

pander(eformat(boot))
```