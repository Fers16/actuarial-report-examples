---
title: "Simple Reserve Report Example"
author: "Andy Merlino"
date: "11/7/2014"
output: 
  pdf_document
---
\begin{abstract}
This document demonstrates how a very simple actuarial reserve report could be created using R.  This document is only for display purposes.  It was created using insurance loss data freely available on the CAS website.  This report could be greatly improved by having better documentation for the relationships among tables.  I am just getting started with \LaTeX\ and will have more clearly documented reports in subsequent examples.
\end{abstract}

```{r generic_info, echo = FALSE}
eval_date <- "December 31, 1997"
```
## Purpose

Ractuary was requested by Nsure Ance Company (NAC) to provide a reserve estimate for their workers' compensation loss and alocated loss adjustment expense (ALAE) reserves.  Losses are evaluated as of `r eval_date`... 

## Background

NAC began offering workers' compensation coverage in 1988.  Each policy is written on a calendar year basis (i.e. beginning January 1 and ending December 31).  NAC has never purchased reinsurense coverage...

## Other Stuff

Blah blah...

\pagebreak

```{r packages_options, message = FALSE, warning = FALSE, echo = FALSE}
# CRAN packages
library(dplyr) # for manipulating data
library(ChainLadder) # reserving projections
library(pander) # make pretty tables

# Ractuary packages. Install with devtools::install_github("merlinoa/*")
library(exhibit) # default exhibits from ChainLadder package
library(casdata) # load in the data

# set pander table options
panderOptions('table.split.table', 125)
panderOptions('table.alignment.default', 'right')
```

```{r data, echo = FALSE}
# filter the data to be used in our projections
wkcomp$calendar <- wkcomp$AccidentYear + wkcomp$DevelopmentLag
state <- wkcomp[wkcomp$GRCODE == 1767 & wkcomp$calendar < 1999, ]
```

```{r data_formation, echo = FALSE}
# Summarize provided data by accident year ======================
latest <- filter(state, calendar == 1998) %>% 
  select(AccidentYear,
         CumPaidLoss_D,
         IncurLoss_D)
names(latest) <- c("year", "paid", "incurred")

# create paid development triangles =============================
paid_tri <- as.triangle(state, 
                        origin = "AccidentYear", 
                        dev = "DevelopmentLag",
                        value = "CumPaidLoss_D")

paid_select <- c(2.7, 1.35, 1.55, 1.08, 1.05, 1.03, 1.025, 1.015, 
            1.013, 1.15)
paid_ata <- exhibit(ata(paid_tri), selection = paid_select)

# create paid projection table ==================================
paid_proj <- data.frame(latest[, 2, drop = FALSE], ldf = cumprod(rev(paid_select)))
paid_proj <- mutate(paid_proj, 
                    ultimate = paid * ldf)
rownames(paid_proj) <- latest$year


# create incurred development triangles ========================
incurred_tri <- as.triangle(state, 
                        origin = "AccidentYear", 
                        dev = "DevelopmentLag",
                        value = "IncurLoss_D")

incurred_select <- c(1.16, 1.05, 1.01, 1.005, 1.001, 1, 1, 1, 1, 1.005)
incurred_ata <- exhibit(ata(incurred_tri), selection = incurred_select)

# create incurred projection table ============================
incurred_proj <- data.frame(latest[, 3, drop = FALSE], ldf = cumprod(rev(incurred_select)))
incurred_proj <- mutate(incurred_proj, 
                    ultimate = incurred * ldf)
rownames(incurred_proj) <- latest$year

# ultimate selection exhibit ==================================
ultimate_selection <- data.frame(paid_projection = paid_proj$ultimate,
                                 incurred_projection = incurred_proj$ultimate)
ultimate_selection <- mutate(ultimate_selection,
                             selected_ultimate = (paid_projection + incurred_projection) / 2
                             )
```

## Conclusions

A summary of our reserve analysis is as follows:

```{r final_summary, echo = FALSE}
smry <- data.frame(latest[, 2:3], 
                   selected_ultimate = ultimate_selection$selected_ultimate
                   )

smry <- mutate(smry, 
               case_os = incurred - paid,
               ibnr = selected_ultimate - incurred,
               total_os = case_os + ibnr)

smry_totals <- lapply(smry, sum)

smry <- rbind(smry, smry_totals)

rownames(smry) <- c(latest$year, "Totals")

smry_out <- smry
names(smry_out) <- c("Paid", "Incurred", "Ultimate", "Case OS", "IBNR", "Total OS")
pander(smry_out)
```

From the table above, estimated ultimate loss & ALAE as of `r eval_date` is `r format(smry_totals[3], big.mark = ",")` indicating a total outstanding loss & ALAE of `r format(smry_totals[6], big.mark = ",")`.

## Methodology

We used two actuarial projection techniques (paid projection and incurred projection) in creating the final estimated ultimate loss projection.  The loss projections use loss experience for the more mature accident years to estimate the development of less mature accident years. See the following exhibits for detail regarding the projections and estimated ultimate loss and ALAE selection.

\pagebreak

## Exhibits

```{r ultimate_selection, echo = FALSE}
ult_selection_totals <- lapply(ultimate_selection, sum)
ult_selection <- rbind(ultimate_selection, ult_selection_totals)
rownames(ult_selection) <- c(latest$year, "Totals")

# rename columns and print ultimate selection table to pdf
ult_selection_out <- ult_selection
names(ult_selection_out) <- c("Paid Projection", "Incurred Projection", "Selected Ultimate")
pander(ult_selection_out, caption = "Selection of Estimated Ultimate Loss & ALAE")
```

\pagebreak

```{r paid_projection_exhibit, echo = FALSE}
# print paid projections exhibit to pdf
paid_proj_out <- paid_proj
names(paid_proj_out) <- c("Paid", "LDF", "Ultimate")
pander(paid_proj_out,
       caption = "Paid Projection")
```

\pagebreak

```{r paid_triangle_tables, echo = FALSE}
pander(exhibit(paid_tri), caption = "Paid Triangle")
pander(paid_ata, caption = "Paid Development Factor Triangle")
```

\pagebreak

```{r incurred_projection_exhibit, echo = FALSE}
# Incurred projection exhibit
incurred_proj_out <- incurred_proj
names(incurred_proj_out) <- c("Incurred", "LDF", "Ultimate")
pander(incurred_proj_out)
```

\pagebreak

```{r incurred_triangle_tables, echo = FALSE}
pander(exhibit(incurred_tri), caption = "Incurred Triangle")
pander(incurred_ata, caption = "Incurred Development Factor Triangle")
```